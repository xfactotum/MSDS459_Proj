<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>jQuery QueryBuilder Example</title>

  <link rel="stylesheet" href="./bootstrap/dist/css/bootstrap.css" id="bt-theme">
  <link rel="stylesheet" href="./bootstrap-select/dist/css/bootstrap-select.css">
  <link rel="stylesheet" href="./chosenjs/chosen.css">
  <link rel="stylesheet" href="./awesome-bootstrap-checkbox/awesome-bootstrap-checkbox.css">
  <link rel="stylesheet" href="./bootstrap-slider/dist/css/bootstrap-slider.css">
  <link rel="stylesheet" href="./selectize/dist/css/selectize.bootstrap3.css">

  <link rel="stylesheet" href="./query-builder/dist/css/query-builder.default.css" id="qb-theme">
  <link rel="stylesheet" href="http://mistic100.github.io/jQuery-QueryBuilder/assets/flags/flags.css">

  <style>
    .flag {
      display: inline-block;
    }
  </style>
</head>

<body>

<div class="container">
  <div class="col-md-12 col-lg-10 col-lg-offset-1">
    <div class="page-header">
      <a class="pull-right" href="https://github.com/xfactotum/MSDS459_Proj">
        <img src="https://github.githubassets.com/images/modules/logos_page/Octocat.png" height=48px>
      </a>
      <h1>K9 Breed Recommender</h1>
    </div>

    <div class="well well-sm">
      <label>Language:</label>
      <select name="language" class="selectpicker show-tick show-menu-arrow" data-width="auto">
        <option value="sq" data-icon="flag flag-al">Albanian</option>
        <option value="ar" data-icon="flag flag-ar">Arabic</option>
        <option value="az" data-icon="flag flag-az">Azerbaijani</option>
        <option value="bg" data-icon="flag flag-bg">Bulgarian</option>
        <option value="zh-CN" data-icon="flag flag-zh-CN">Simplified Chinese</option>
        <option value="cs" data-icon="flag flag-cs">Czech</option>
        <option value="de" data-icon="flag flag-de">German</option>
        <option value="da" data-icon="flag flag-dk">Danish</option>
        <option value="nl" data-icon="flag flag-nl">Dutch</option>
        <option value="en" data-icon="flag flag-gb" selected>English</option>
        <option value="fa-IR" data-icon="flag flag-ir">Farsi</option>
        <option value="fr" data-icon="flag flag-fr">French</option>
        <option value="el" data-icon="flag flag-el">Greek</option>
        <option value="he" data-icon="flag flag-he">Hebrew</option>
        <option value="it" data-icon="flag flag-it">Italian</option>
        <option value="no" data-icon="flag flag-no">Norwegian</option>
        <option value="pl" data-icon="flag flag-pl">Polish</option>
        <option value="pt-PT" data-icon="flag flag-pt-PT">Portuguese</option>
        <option value="pt-BR" data-icon="flag flag-pt-BR">Brazilian Portuguese</option>
        <option value="ro" data-icon="flag flag-ro">Romanian</option>
        <option value="ru" data-icon="flag flag-ru">Russian</option>
        <option value="es" data-icon="flag flag-es">Spanish</option>
        <option value="tr" data-icon="flag flag-tr">Turkish</option>
        <option value="ua" data-icon="flag flag-ua">Ukrainian</option>
      </select>
    </div>

    <div id="builder"></div>

    <div class="btn-group">
      <button class="btn btn-danger reset">Reset</button>
    </div>

    <div class="btn-group">
      <button class="btn btn-default" disabled>Get:</button>
      <button class="btn btn-primary parse-json">JSON</button>
      <button class="btn btn-primary parse-sql" data-stmt="false">SQL</button>
      <button class="btn btn-primary parse-sql" data-stmt="question_mark">SQL statement</button>
      <button class="btn btn-primary parse-mongo">MongoDB</button>
    </div>

    <div id="output" class="hide">
      <h3>Output</h3>
      <pre></pre>
    </div>

    <div id="result" class="hide">
      <h3>Results</h3>
      <pre></pre>
    </div>
  </div>
</div>

<script src="./jquery/dist/jquery.js"></script>
<script src="./bootstrap/dist/js/bootstrap.js"></script>
<script src="./bootstrap-select/dist/js/bootstrap-select.js"></script>
<script src="./chosenjs/chosen.jquery.js"></script>
<script src="./bootbox/bootbox.js"></script>
<script src="./bootstrap-slider/dist/bootstrap-slider.js"></script>
<script src="./selectize/dist/js/standalone/selectize.js"></script>
<script src="./jquery-extendext/jquery-extendext.js"></script>
<script src="./sql-parser-mistic/browser/sql-parser.js"></script>
<script src="./interactjs/dist/interact.js"></script>

<script src="./query-builder/dist/js/query-builder.js"></script>

<script>
  $('[data-toggle="tooltip"]').tooltip();

  var $b = $('#builder');

  var options = {
    allow_empty: true,

    //default_filter: 'name',
    sort_filters: true,

    optgroups: {
      breed: {
        en: 'Breed',
        fr: 'Race',
        es: 'Raza'
      },
      loc: {
        en: 'Origin',
        fr: 'Origine',
        es: 'Origen'
      },
      quality: {
        en: 'Quality',
        fr: 'Qualit√©',
        es: 'Calidad'
      }
    },

    plugins: {
      'bt-tooltip-errors': { delay: 100 },
      'sortable': null,
      'filter-description': { mode: 'bootbox' },
      'bt-selectpicker': null,
//      'chosen-selectpicker': null,
      'unique-filter': null,
      'bt-checkbox': { color: 'primary' },
      'invert': null,
      'not-group': null
    },

    // standard operators in custom optgroups
    operators: [
      { type: 'equal', optgroup: 'basic' },
      { type: 'not_equal', optgroup: 'basic' },
      { type: 'in', optgroup: 'basic' },
      { type: 'not_in', optgroup: 'basic' },
      // { type: 'less', optgroup: 'numbers' },
      { type: 'less_or_equal', optgroup: 'numbers' },
      // { type: 'greater', optgroup: 'numbers' },
      { type: 'greater_or_equal', optgroup: 'numbers' },
      { type: 'between', optgroup: 'numbers' },
      { type: 'not_between', optgroup: 'numbers' },
      { type: 'begins_with', optgroup: 'strings' },
      { type: 'not_begins_with', optgroup: 'strings' },
      { type: 'contains', optgroup: 'strings' },
      { type: 'not_contains', optgroup: 'strings' },
      { type: 'ends_with', optgroup: 'strings' },
      { type: 'not_ends_with', optgroup: 'strings' },
      { type: 'is_empty' },
      { type: 'is_not_empty' },
      { type: 'is_null' },
      { type: 'is_not_null' }
    ],

    filters: [
      /*
       * string with separator
       */
      {
        id: 'wish',
        field: 'userwish',
        label: {
          en: 'Wish',
          fr: 'Souhait',
          es: 'Deseo'
        },
        icon: 'glyphicon glyphicon-star-empty',
        value_separator: ',',
        type: 'string',
        optgroup: 'breed',
        default_value: 'I want a loyal and obedient dog that barks little',
        input: 'textarea',
        operators: ['equal'],
        size: 30,
        rows: 3,
        validation: {
          allow_empty_value: true
        },
        unique: true
      },
      /*
       * select
       */
      {
        id: 'country',
        label: {
          en: 'Country',
          fr: 'Pays',
          es: 'Pais'
        },
        icon: 'glyphicon glyphicon-globe',
        type: 'string',
        input: 'select',
        optgroup: 'loc',
        placeholder: 'Select something',
        values: [
          {
            label: 'Central Africa',
            value: 'Central Africa',
            optgroup: 'Africa'
          },
          {
            label: 'Madagascar',
            value: 'Madagascar',
            optgroup: 'Africa'
          },
          {
            label: 'North Africa',
            value: 'North Africa',
            optgroup: 'Africa'
          },
          {
            label: 'Rhodesia',
            value: 'Rhodesia',
            optgroup: 'Africa'
          },
          {
            label: 'South Africa',
            value: 'South Africa',
            optgroup: 'Africa'
          },
          {
            label: 'West Africa',
            value: 'West Africa',
            optgroup: 'Africa'
          },
          {
            label: 'Canada',
            value: 'Canada',
            optgroup: 'North America'
          },
          {
            label: 'Mexico',
            value: 'Mexico',
            optgroup: 'North America'
          },
          {
            label: 'United States',
            value: 'United States',
            optgroup: 'North America'
          },
          {
            label: 'Argentina',
            value: 'Argentina',
            optgroup: 'South America'
          },
          {
            label: 'Brazil',
            value: 'Brazil',
            optgroup: 'South America'
          },
          {
            label: 'Cuba',
            value: 'Cuba',
            optgroup: 'South America'
          },
          {
            label: 'Afghanistan',
            value: 'Afghanistan',
            optgroup: 'Asia'
          },
          {
            label: 'China',
            value: 'China',
            optgroup: 'Asia'
          },
          {
            label: 'India',
            value: 'India',
            optgroup: 'Asia'
          },
          {
            label: 'Israel',
            value: 'Israel',
            optgroup: 'Asia'
          },
          {
            label: 'Japan',
            value: 'Japan',
            optgroup: 'Asia'
          },
          {
            label: 'South Korea',
            value: 'South Korea',
            optgroup: 'Asia'
          },
          {
            label: 'Thailand',
            value: 'Thailand',
            optgroup: 'Asia'
          },
          {
            label: 'Tibet',
            value: 'Tibet',
            optgroup: 'Asia'
          },
          {
            label: 'Turkey',
            value: 'Turkey',
            optgroup: 'Asia'
          },
          {
            label: 'Armenia',
            value: 'Armenia',
            optgroup: 'Europe'
          },
          {
            label: 'Belgium',
            value: 'Belgium',
            optgroup: 'Europe'
          },
          {
            label: 'Bosnia and Herzegovina',
            value: 'Bosnia and Herzegovina',
            optgroup: 'Europe'
          },
          {
            label: 'Croatia',
            value: 'Croatia',
            optgroup: 'Europe'
          },
          {
            label: 'Czech Republic',
            value: 'Czech Republic',
            optgroup: 'Europe'
          },
          {
            label: 'Denmark',
            value: 'Denmark',
            optgroup: 'Europe'
          },
          {
            label: 'England',
            value: 'England',
            optgroup: 'Europe'
          },
          {
            label: 'Finland',
            value: 'Finland',
            optgroup: 'Europe'
          },
          {
            label: 'France',
            value: 'France',
            optgroup: 'Europe'
          },
          {
            label: 'Georgia',
            value: 'Georgia',
            optgroup: 'Europe'
          },
          {
            label: 'Germany',
            value: 'Germany',
            optgroup: 'Europe'
          },
          {
            label: 'Greece',
            value: 'Greece',
            optgroup: 'Europe'
          },
          {
            label: 'Hungary',
            value: 'Hungary',
            optgroup: 'Europe'
          },
          {
            label: 'Belgium',
            value: 'Belgium',
            optgroup: 'Europe'
          },
          {
            label: 'Iceland',
            value: 'Iceland',
            optgroup: 'Europe'
          },
          {
            label: 'Ireland',
            value: 'Ireland',
            optgroup: 'Europe'
          },
          {
            label: 'Italy',
            value: 'Italy',
            optgroup: 'Europe'
          },
          {
            label: 'Malta',
            value: 'Malta',
            optgroup: 'Europe'
          },
          {
            label: 'Netherlands',
            value: 'Netherlands',
            optgroup: 'Europe'
          },
          {
            label: 'Norway',
            value: 'Norway',
            optgroup: 'Europe'
          },
          {
            label: 'Poland',
            value: 'Poland',
            optgroup: 'Europe'
          },
          {
            label: 'Pomerania',
            value: 'Pomerania',
            optgroup: 'Europe'
          },
          {
            label: 'Portugal',
            value: 'Portugal',
            optgroup: 'Europe'
          },
          {
            label: 'Russia',
            value: 'Russia',
            optgroup: 'Europe'
          },
          {
            label: 'Scotland',
            value: 'Scotland',
            optgroup: 'Europe'
          },
          {
            label: 'Siberia',
            value: 'Siberia',
            optgroup: 'Europe'
          },
          {
            label: 'Slovakia',
            value: 'Slovakia',
            optgroup: 'Europe'
          },
          {
            label: 'Spain',
            value: 'Spain',
            optgroup: 'Europe'
          },
          {
            label: 'Sweden',
            value: 'Sweden',
            optgroup: 'Europe'
          },
          {
            label: 'Switzerland',
            value: 'Switzerland',
            optgroup: 'Europe'
          },
          {
            label: 'Wales',
            value: 'Wales',
            optgroup: 'Europe'
          },
          {
            label: 'Australia',
            value: 'Australia',
            optgroup: 'Oceania'
          }
        ],
        operators: ['equal', 'not_equal', 'is_null', 'is_not_null']
      },
      /*
       * slider
       */
      {
        id: 'playful',
        label: {
          en: 'Playful',
          fr: 'Espi√®gle',
          es: 'Juguet√≥n'
        },
        icon: 'glyphicon glyphicon-filter',
        type: 'integer',
        optgroup: 'quality',
        validation: {
          min: 0,
          max: 5
        },
        plugin: 'slider',
        plugin_config: {
          min: 0,
          max: 5,
          ticks: [0, 2.5, 5],
          ticks_labels: ['None', 'Mild', 'Very'],
          value: 0
        },
        valueSetter: function(rule, value) {
          var input = rule.$el.find('.rule-value-container input');
          input.slider('setValue', value);
          input.val(value);
        }
      },
      {
        id: 'barking',
        label: {
          en: 'Barking',
          fr: 'Aboiement',
          es: 'Ladrido'
        },
        icon: 'glyphicon glyphicon-filter',
        type: 'integer',
        optgroup: 'quality',
        validation: {
          min: 0,
          max: 5
        },
        plugin: 'slider',
        plugin_config: {
          min: 0,
          max: 5,
          ticks: [0, 2.5, 5],
          ticks_labels: ['None', 'Mild', 'Very'],
          value: 0
        },
        valueSetter: function(rule, value) {
          var input = rule.$el.find('.rule-value-container input');
          input.slider('setValue', value);
          input.val(value);
        }
      },
      {
        id: 'drool',
        label: {
          en: 'Drooling',
          fr: 'Baveux',
          es: 'Babeo'
        },
        icon: 'glyphicon glyphicon-filter',
        type: 'integer',
        optgroup: 'quality',
        validation: {
          min: 0,
          max: 5
        },
        plugin: 'slider',
        plugin_config: {
          min: 0,
          max: 5,
          ticks: [0, 2.5, 5],
          ticks_labels: ['None', 'Mild', 'Very'],
          value: 0
        },
        valueSetter: function(rule, value) {
          var input = rule.$el.find('.rule-value-container input');
          input.slider('setValue', value);
          input.val(value);
        }
      },
      {
        id: 'age',
        label: {
          en: 'Life expectancy',
          fr: 'Esp√©rance de vie',
          es: 'Esperanza de vida'
        },
        icon: 'glyphicon glyphicon-calendar',
        type: 'integer',
        optgroup: 'breed',
        validation: {
          min: 6,
          max: 18
        },
        plugin: 'slider',
        plugin_config: {
          min: 6,
          max: 18,
          ticks: [6, 9, 12, 15, 18],
          ticks_labels: ['6', '9', '12', '15', '18y'],
          value: 6
        },
        valueSetter: function(rule, value) {
          var input = rule.$el.find('.rule-value-container input');
          input.slider('setValue', value);
          input.val(value);
        }
      },
      {
        id: 'height',
        label: {
          en: 'Height',
          fr: 'Hauteur',
          es: 'Altura'
        },
        icon: 'glyphicon glyphicon-resize-vertical',
        type: 'integer',
        optgroup: 'breed',
        validation: {
          min: 4,
          max: 33
        },
        plugin: 'slider',
        plugin_config: {
          min: 4,
          max: 33,
          ticks: [4, 11, 19, 26, 33],
          ticks_labels: ['4"', '11', '19', '26', '33'],
          value: 4
        },
        valueSetter: function(rule, value) {
          var input = rule.$el.find('.rule-value-container input');
          input.slider('setValue', value);
          input.val(value);
        }
      },
      {
        id: 'weight',
        label: {
          en: 'Weight',
          fr: 'Poids',
          es: 'Peso'
        },
        icon: 'glyphicon glyphicon-scale',
        type: 'integer',
        optgroup: 'breed',
        validation: {
          min: 5,
          max: 60
        },
        plugin: 'slider',
        plugin_config: {
          min: 5,
          max: 60,
          ticks: [5, 19, 33, 46, 60],
          ticks_labels: ['5lbs', '19', '33', '46', '60'],
          value: 5
        },
        valueSetter: function(rule, value) {
          var input = rule.$el.find('.rule-value-container input');
          input.slider('setValue', value);
          input.val(value);
        }
      }]
  };

  // init
  $('#builder').queryBuilder(options);

  $('#builder').on('afterCreateRuleInput.queryBuilder', function(e, rule) {
    if (rule.filter.plugin == 'selectize') {
      rule.$el.find('.rule-value-container').css('min-width', '200px')
        .find('.selectize-control').removeClass('form-control');
    }
  });

  // change language
  $('[name=language]').selectpicker().on('change', function() {
    var lang = $(this).val();

    var done = function() {
      var rules = $b.queryBuilder('getRules');
      if (!$.isEmptyObject(rules)) {
        options.rules = rules;
      }
      else {
        delete options.rules;
      }
      options.lang_code = lang;
      $b.queryBuilder('destroy');
      $('#builder').queryBuilder(options);
    };

    if ($.fn.queryBuilder.regional[lang] === undefined) {
      $.getScript('./query-builder/dist/i18n/query-builder.' + lang + '.js', done);
    }
    else {
      done();
    }
  });

  // change theme
  $('.change-theme').on('click', function() {
    $('#qb-theme').replaceWith('<link rel="stylesheet" href="' + $(this).data('qb') + '" id="qb-theme">');
    $('#bt-theme').replaceWith('<link rel="stylesheet" href="' + $(this).data('bt') + '" id="bt-theme">');
  });

  // set rules
  $('.set').on('click', function() {
    $('#builder').queryBuilder('setRules', {
      condition: 'AND',
      flags: {
        condition_readonly: true
      },
      data: {
        root: true
      },
      rules: [{
        id: 'price',
        operator: 'between',
        value: [10.25, 15.52],
        flags: {
          no_delete: true,
          filter_readonly: true
        },
        data: {
          unit: '‚Ç¨'
        }
      }, {
        id: 'state',
        operator: 'equal',
        value: 'AK'
      }, {
        condition: 'OR',
        not: true,
        flags: {
          no_delete: true,
          no_drop: true,
          no_sortable: true
        },
        rules: [{
          id: 'category',
          operator: 'equal',
          value: 2
        }, {
          id: 'coord',
          operator: 'equal',
          value: undefined // will use filter's default value
        }]
      }, {
        id: 'name',
        operator: 'in',
        value: ['Mistic', 'Damien']
      }, {
        id: 'age',
        operator: 'in',
        value: [20,21,22]
      }, {
        empty: true
      }]
    });
  });

  // set rules from MongoDB
  $('.set-mongo').on('click', function() {
    $('#builder').queryBuilder('setRulesFromMongo', {
      "$or": [{
        "username": {
          "$regex": "^(?!Mistic)"
        }
      }, {
        "price": { "$gte": 0, "$lte": 100 }
      }, {
        "$nor": [{
          "$and": [{
            "category": 2
          }, {
            "category": { "$in": [4, 5] }
          }]
        }]
      }]
    });
  });

  // reset builder
  $('.reset').on('click', function() {
    $('#builder').queryBuilder('reset');
    $('#output').addClass('hide').find('pre').empty();
  });

  // get rules
  $('.parse-json').on('click', function() {
    $('#output').removeClass('hide')
      .find('pre').html(JSON.stringify(
      $('#builder').queryBuilder('getRules', {
        get_flags: true,
        skip_empty: true
      }),
      undefined, 2
    ));
  });

  $('.parse-sql').on('click', function() {
    var res = $('#builder').queryBuilder('getSQL', $(this).data('stmt'), false);
    $('#output').removeClass('hide')
      .find('pre').html(
      res.sql + (res.params ? '\n\n' + JSON.stringify(res.params, undefined, 2) : '')
    );
  });

  $('.parse-mongo').on('click', function() {
    $('#output').removeClass('hide')
      .find('pre').html(JSON.stringify(
      $('#builder').queryBuilder('getMongo'),
      undefined, 2
    ));
    $.ajax({
        url: "/recommendBreed",
        method: "POST",
        data: JSON.stringify(
          $('#builder').queryBuilder('getMongo'),
          undefined, 2
        ),
        contentType: "application/json; charset=utf-8",
        dataType: "json",
        success: function(response) {
          var objMap = eval(response.replace(/\\/g,''));
          console.log('', objMap);
          $('#result').removeClass('hide')
            .find('pre').html(JSON.stringify(objMap, undefined, 2));
        },
        error: function(error) {
          console.log("Error: ", error);
        }
    });
  });

  // set filters
  $('.set-filters').on('click', function() {
    $(this).prop('disabled', true);
    $(this).tooltip('hide');

    // add a new filter after 'state'
    $('#builder').queryBuilder('addFilter',
      {
        id: 'new_one',
        label: 'New filter',
        type: 'string'
      },
      'state'
    );

    // remove filter 'coord'
    $('#builder').queryBuilder('removeFilter',
      ['coord', 'state', 'bson'],
      true
    );

    // also available : 'setFilters'
  });
</script>

</body>
</html>
